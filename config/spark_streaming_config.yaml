# Spark Streaming Configuration for Speed Layer
# Configuration for real-time streaming jobs processing TMDB data
# Updated to match new schema: review_sentiments, movie_stats, trending_movies

kafka:
  bootstrap_servers: "${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}"
  security_protocol: "PLAINTEXT"
  batch_size: 1000
  linger_ms: 100
  buffer_memory: 33554432
  schema_registry_url: "${SCHEMA_REGISTRY_URL:http://localhost:8081}"
  
  # Kafka topic names (3 topics as per new architecture)
  topics:
    reviews: "movie.reviews"         # Review data from TMDB
    ratings: "movie.ratings"         # Rating updates from TMDB
    metadata: "movie.metadata"       # Movie metadata updates
  
spark:
  app_name: "speed-layer-streaming"
  master: "local[*]"
  log_level: "WARN"
  
  # Streaming configuration
  streaming:
    batch_duration: "5 minutes"
    watermark_duration: "10 minutes"
    checkpoint_location: "/app/checkpoints"
    max_offsets_per_trigger: 1000
    
  # Cassandra connector configuration
  cassandra:
    connection:
      host: "${CASSANDRA_HOSTS:localhost}"
      port: 9042
      local_dc: "datacenter1"
    keyspace: "speed_layer"
    
  # Memory and execution settings
  executor:
    memory: "2g"
    cores: 2
    instances: 2
    
  driver:
    memory: "1g"
    cores: 1
    
  # Additional Spark configurations
  config:
    spark.sql.adaptive.enabled: "true"
    spark.sql.adaptive.coalescePartitions.enabled: "true"
    spark.sql.streaming.forceDeleteTempCheckpointLocation: "true"
    spark.cassandra.connection.host: "${CASSANDRA_HOSTS:localhost}"
    spark.cassandra.connection.port: "9042"
    spark.cassandra.output.consistency.level: "ONE"
    
# Sentiment Analysis Configuration
sentiment:
  model: "vader"
  batch_size: 100
  confidence_threshold: 0.1
  
# Windowing Configuration
windowing:
  tumbling_window: "5 minutes"
  sliding_window: "1 minute"
  watermark: "10 minutes"

# Processing Configuration
processing:
  window_duration: "5 minutes"
  slide_duration: "1 minute"
  watermark_delay: "10 minutes"
  trigger_interval: "30 seconds"
  
# Output Configuration
output:
  mode: "append"
  trigger: "processingTime='5 minutes'"
  
# Checkpoint locations for each streaming job
checkpoints:
  review_sentiment: "/tmp/checkpoints/review_sentiment"
  movie_aggregation: "/tmp/checkpoints/movie_aggregation"
  trending_detection: "/tmp/checkpoints/trending_detection"
  
# Monitoring Configuration
monitoring:
  metrics_enabled: true
  log_level: "INFO"
  checkpoint_interval: "5 minutes"